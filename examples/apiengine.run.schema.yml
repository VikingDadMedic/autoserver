engine: apiengine 1.0.0
models:
  pet:
    description: Cute animal
    database: memory
    authorize:
      $command:
        _in: (['find', 'delete', 'create', 'upsert', 'patch'])
    __custom: anything
    __second_custom:
      $ref: '#/models/pet/__custom'
    attributes:
      id:
        description: Unique identifier of a pet
      name:
        type: string
        description: How to call a pet
        validate:
          required: true
          oneOf:
          - pattern: '^[a-zA-Z]+$'
          - pattern: '[0-9]+$'
          allOf:
          - not:
              pattern: '^__'
          - not:
              pattern: '^[0-9]'
          anyOf:
          - pattern: '[a-z]'
          - pattern: '[A-Z]'
          - pattern: '[0-9]'
          if:
            pattern: '^super'
          then:
            pattern: '[a-z]'
          else:
            pattern: '[A-Z]'
        __custom: anything
      weight:
        type: number
        description: Corrolated to how much a pet has eaten
        deprecation_reason: Let's stop measuring pet's weight
        default: 15
        alias: old_weight_name
        validate:
          minimum: 0.5
          maximum: 30
          exclusiveMinimum: 0.5
          exclusiveMaximum: 30
          multipleOf: 0.000001
          __is_not_equal: 10
      is_overweight:
        type: boolean
        description: Has the pet being eating too much?
        default: false
        validate:
          const: false
      photo_urls:
        type: string[]
        description: Sweet pictures of a pet
        examples:
        - http://www.photos.org/1.jpg
        - http://www.photos.org/3.jpg
        validate:
          required: true
      skills:
        type: pet_skills
      tags:
        type: string[]
        description: Tags applying to this pet
        default: []
        validate:
          items:
            minLength: 2
            maxLength: 200
            pattern: '^[a-zA-Z0-9 ]+$'
            enum: [suspended, adorable]
          if:
            minItems: 10
          then:
            contains:
              enum: [suspended]
          additionalItems: false
          minItems: 0
          maxItems: 30
          uniqueItems: true
      status:
        description: Has this pet been adopted
        value: '(typeof $val === "string" ? $val.toLowerCase() + " " + $model.weight : $val)'
        default:
          $ref: default_value.js
      creator_key:
        description: Key of the user that created this pet
        value: (String(more_recursive_func()))
      best_friend:
        type: pet
        description: This pet's best friend
        validate:
          dependencies: [friends]
      friends:
        type: pet[]
        description: This pet's friends
        validate:
          required: true
      owners:
        type: owner[]
      birth_date:
        default: (birth_date)
        validate:
          format: date
          formatMinimum: '2000-01-01'
          formatExclusiveMinimum: true
          formatMaximum: '2100-01-01'
          formatExclusiveMaximum: false
  owner:
    $ref: owner.yml
  pet_skills:
    $ref: pet_skills.yml
  default: {}
authorize:
- $command:
    _in: [find, delete]
- $command:
    _in: [find, create, upsert, patch]
variables:
  my_math_func: (($1 * $2) + ($3 * $4))
  example_function: '(my_math_func(1, 10, 100, 2) +
    my_other_math_func({ numA: 1, numB: 10, numC: 100, numD: 2 }))'
  recursive_func: (example_function())
  more_recursive_func: (recursive_func() + constants.TestConstant +
    string.titleize($operation))
  my_other_math_func:
    $ref: math_func.js
  birth_date: 2005-01-01
  user: '(({ id: "1" }))'
  constants:
    $ref: constants.json
  string:
    $ref: underscore.string.node
  lodash:
    $ref: lodash.node
plugins:
- plugin:
    $ref: test_plugin.js
  opts:
    example_option: true
  enabled: true
- plugin: author
  opts:
    currentuser: (user())
    usermodel: owner
validation:
  __is_not_equal:
    test: ($val !== $expected)
    message: (`must not be equal to ${$expected}`)
    type: number
__custom: anything
